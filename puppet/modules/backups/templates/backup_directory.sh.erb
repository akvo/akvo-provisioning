#!/bin/bash

# ====
# <%= @name %>
# ====

# This script will back up <%= @path %>

# ====
# Config
# ====

SOURCE=<%= @path%>

<% if @plain_copy %>
    RETAIN=''
    PERIOD=''
<% else %>
    PERIOD=$1
    RETAIN=<%= @retain_count %>
<% end %>

NAME=<%= @name %>
BASE_SCRIPT_DIR=<%= @backup_bin_dir %>
SCRIPT_PREFIX=<%= @script_prefix %>

SCRIPT_ARGS="$SOURCE $PERIOD $RETAIN $NAME"


# ====
# Exec
# ====

<% @backup_servers.each_pair do |dest_name, details| %>
BACKUP_TO_DEST=${BASE_SCRIPT_DIR}/${SCRIPT_PREFIX}_backup_to_<%= "#{dest_name}" %>.sh
$BACKUP_TO_DEST $SCRIPT_ARGS
<% end %>
