#!/bin/bash
set -e

KC_FILE="keycloak-<%= @kc_release %>.tar.gz"
KC_FILE_URL="http://files.support.akvo-ops.org/keycloak/${KC_FILE}"
KC_THEME_FILE="themes.tar.gz"
KC_THEME_FILE_URL="http://files.support.akvo-ops.org/keycloak/${KC_THEME_FILE}"

PSQL_DRIVER_FILE="postgresql-<%= @psql_driver_release %>.jar"
PSQL_DRIVER_FILE_URL="http://central.maven.org/maven2/org/postgresql/postgresql/<%= @psql_driver_release %>/${PSQL_DRIVER_FILE}"

wget "${KC_FILE_URL}"
tar xzvf "${KC_FILE}"
rm "${KC_FILE}"

cd "<%= @appdir %>"
wget "${KC_THEME_FILE_URL}"
tar xzvf "${KC_THEME_FILE}"
rm "${KC_THEME_FILE}"

mkdir -p "<%= @psql_driver_dir %>"
cd "<%= @psql_driver_dir %>"
wget -N "${PSQL_DRIVER_FILE_URL}"

touch "<%= @approot %>/.installed-keycloak-<%= @kc_release %>-postgresql-<%= @psql_driver_release =>"
