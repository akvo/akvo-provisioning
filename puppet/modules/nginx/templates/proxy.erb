server {

    <% if @ssl %>
        listen 443;
        ssl on;

        ssl_certificate       <%= ssl_crt %>;
        ssl_certificate_key   <%= ssl_key %>;
        ssl_protocols         SSLv3 TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers           RC4:HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers on;
        ssl_session_cache    shared:SSL:10m;
        ssl_session_timeout  10m;

    <% else %>
        listen       80;
    <% end -%>

    server_name  <%= server_name %>;
    
    location / {

        proxy_pass   <%= proxy_url %>;
        proxy_set_header   Host             $host;
        proxy_set_header   X-Real-IP        $remote_addr;
        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;

        <% if @password_protected %>
           auth_basic            "Restricted";
           auth_basic_user_file  <%= htpasswd_file %>;
        <% end -%>

        <% if @ssl %>
            add_header              Front-End-Https   on;
        <% end -%>
    }


}

