#!/bin/bash

ORIG_DIR=`pwd`

NAME=$1
BRANCH=$2

ROOT=<%= @approot %>/versions/$NAME

mkdir -p $ROOT
virtualenv $ROOT/venv

git clone https://github.com/akvo/akvo-rsr.git $ROOT/code
cd $ROOT/code
git checkout $BRANCH
cd $ORIG_DIR

ln -s <%= @approot %>/local_settings.conf $ROOT/code/akvo/settings/65_puppet.conf

PIP=$ROOT/venv/bin/pip

$PIP install -r $ROOT/code/scripts/deployment/pip/requirements/2_rsr.txt
# due to a stupid dependency of django-counter, both PIL and Pillow will be installed, so we'll remove them
# here and reinstall
$PIP uninstall --yes PIL Pillow
$PIP install Pillow==2.0.0

